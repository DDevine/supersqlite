language: python

env:
  global:
    CIBW_BUILD_VERBOSITY: 3
    PIP: pip3

language: generic

os:
  - linux
  - osx

matrix:
  exclude:
    - os: linux
    - os: osx
  include:
    - os: osx
      osx_image: xcode10.1


script:
  - /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
  - brew install gcc@8 --without-multilib
  - export CC="/usr/local/Cellar/gcc/8.2.0/bin/gcc-8"
  - export PYTHONPATH=$(python3 -c "import site; print(site.getsitepackages())[0]")
  - echo $PYTHONPATH
  - $PIP install pip setuptools -U
  - $PIP install cibuildwheel==0.10.0
  - eval "buildwheel() { cibuildwheel --output-dir wheelhouse >>buildwheel.log 2>&1; }"
  - travis_wait 60 buildwheel || (tail -c 3670016 buildwheel.log && exit 1)
  - tail -c 3670016 buildwheel.log
  - ls wheelhouse
  - $PIP install awscli --upgrade
  - python3 -m awscli s3 sync ./wheelhouse/ s3://supersqlite.plasticity.ai/wheelhouse/
